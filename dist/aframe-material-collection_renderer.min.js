!function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(s,n,function(t){return e[t]}.bind(null,n));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=60)}({11:function(e,t){e.exports=AFRAME.registerPrimitive("a-ui-renderer",AFRAME.utils.extendDeep({},AFRAME.primitives.getMeshMixin(),{defaultComponents:{"ui-renderer":{}},mappings:{"ui-panel":"ui-renderer.uiPanel","look-controls-el":"ui-renderer.lookControlsEl","look-controls-component":"ui-renderer.lookControlsComponent","panel-position":"ui-renderer.panelPosition","panel-size":"ui-renderer.panelSize","render-resolution":"ui-renderer.renderResolution","debug-raycaster":"ui-renderer.debugRaycaster",fps:"ui-renderer.fps","intersectable-class":"ui-renderer.intersectableClass","render-debug":"ui-renderer.debug","init-delay":"ui-renderer.initDelay"}}))},23:function(e,t){e.exports=AFRAME.registerComponent("ui-renderer",{schema:{uiPanel:{type:"selector"},lookControlsEl:{type:"selector"},lookControlsComponent:{default:"look-controls"},panelPosition:{type:"vec3",default:{x:0,y:1.6,z:-1}},panelSize:{type:"vec2",default:{x:6,y:3}},renderResolution:{type:"vec2",default:{x:1024,y:512}},debugRaycaster:{type:"boolean",default:!1},fps:{type:"number",default:45},intersectableClass:{default:"intersectable"},debug:{type:"boolean",default:!1},initDelay:{type:"int",default:500}},init(){this.setupBackDrop(),this.data.uiPanel?this.meshEl=this.data.uiPanel:this.meshEl=this.setupUIPanel(),this.el.object3D.parent.remove(this.el.object3D),this.camera=new THREE.PerspectiveCamera(100,2,.1,1e3),this.renderTarget=new THREE.WebGLRenderTarget(this.data.renderResolution.x,this.data.renderResolution.y,{antialias:!0}),this.meshEl.getObject3D("mesh").material.map=this.renderTarget.texture,this.meshEl.emit("texture-ready",this.renderTarget.texture),this.stoppedRendering=!1,this.isRendering=!0,this.el.sceneEl.addEventListener("ui-changing",()=>{this.stoppedRendering=!1,this.isRendering=!0}),this.el.sceneEl.addEventListener("ui-changing-stopped",()=>{this.isRendering=!1}),this.raycaster=new THREE.Raycaster,this.helper=new THREE.Mesh(new THREE.SphereGeometry(.01),new THREE.MeshBasicMaterial({color:"#ff0000"})),this.data.debugRaycaster&&this.el.object3D.add(this.helper),this.lastRenderTime=0,this.isFrozen=!1,this.el.pauseRender=this.pauseRender.bind(this),this.el.playRender=this.playRender.bind(this),this.isReady=!1,setTimeout(()=>{this.isReady=!0,UI.utils.isChanging(this.el.sceneEl,this.el.object3D.uuid),setTimeout(()=>{UI.utils.stoppedChanging(this.el.object3D.uuid)},250)},this.data.initDelay)},pauseRender(e){return this.playRender(e,!0)},playRender(e,t){let i=this;return new Promise(s=>{if(i.isFrozen===t||i.isAnimatingBackground)return s();i.isAnimatingBackground=!0,i.isFrozen||this.backdrop.setAttribute("scale","1 1 1");let n=i.isFrozen?.9:1e-6,r=i.isFrozen?1e-6:.9,o=i.isFrozen?e||350:e||500;i.isFrozen&&(i.isFrozen=t,i.play()),UI.utils.isChanging(i.el.sceneEl,i.backdrop.uuid),i.renderTween&&i.renderTween.stop(),i.renderTween=new TWEEN.Tween({x:n}).to({x:r},o).onUpdate(function(){i.backdrop.setAttribute("opacity",this.x)}).onComplete(()=>{i.isFrozen=t,i.isAnimatingBackground=!1,i.isFrozen?i.pause():this.backdrop.setAttribute("scale","0.000001 0.000001 0.000001"),UI.utils.stoppedChanging(this.backdrop.uuid),s()}).easing(TWEEN.Easing.Exponential.Out).start()})},setupBackDrop(){this.backdrop=document.createElement("a-plane"),this.backdrop.setAttribute("transparent",!0),this.backdrop.setAttribute("opacity",1e-6),this.backdrop.setAttribute("color","#000"),this.backdrop.setAttribute("shader","flat"),this.backdrop.setAttribute("position",{x:0,y:0,z:-.2}),this.backdrop.setAttribute("width",1),this.backdrop.setAttribute("height",1),this.backdrop.setAttribute("scale","0.000001 0.000001 0.000001"),this.el.appendChild(this.backdrop)},play(){this.lastMouseMoveTime=0,this.click=(e=>this.mouseEvent("click",this.lastMoveEvent||e)),this.mousedown=(e=>this.mouseEvent("mousedown",this.lastMoveEvent||e)),this.mouseup=(e=>this.mouseEvent("mouseup",this.lastMoveEvent||e)),this.mousewheel=(e=>this.mouseEvent("ui-mousewheel",e.detail.evt)),this.mousemove=(e=>{this.lastMoveEvent=e,this.mouseEvent("ui-mousemove",e)}),this.meshEl.addEventListener("mousedown",this.mousedown),this.meshEl.addEventListener("mouseup",this.mouseup),this.meshEl.addEventListener("click",this.click),this.meshEl.addEventListener("ui-mousemove",this.mousemove),this.meshEl.addEventListener("ui-mousewheel",this.mousewheel)},pause(){this.meshEl.removeEventListener("mousedown",this.mousedown),this.meshEl.removeEventListener("mouseup",this.mouseup),this.meshEl.removeEventListener("click",this.click),this.meshEl.removeEventListener("ui-mousemove",this.mousemove),this.meshEl.removeEventListener("ui-mousewheel",this.mousewheel)},setupUIPanel(){let e=document.createElement("a-plane");return e.setAttribute("position",this.data.panelPosition),e.setAttribute("width",this.data.panelSize.x),e.setAttribute("height",this.data.panelSize.y),this.el.sceneEl.appendChild(e),e},mouseEvent(e,t){let i={x:0,y:0};if(t.detail&&t.detail.intersection){let e=this.meshEl.object3D.worldToLocal(t.detail.intersection.point.clone());i={x:e.x/this.meshEl.getAttribute("width")*2,y:e.y/this.meshEl.getAttribute("height")*2}}"ui-mousewheel"===e&&(t.detail||t.deltaX||t.deltaY)&&(i.deltaX=t.detail?t.detail.deltaX:t.deltaX,i.deltaY=t.detail?t.detail.deltaY:t.deltaY),"mousedown"===e&&this.lookControlsEl&&this.lookControlsEl.components["look-controls"]&&this.lookControlsEl.components[this.data.lookControlsComponent].pause(),"mouseup"===e&&this.lookControlsEl&&this.lookControlsEl.components["look-controls"]&&this.lookControlsEl.components[this.data.lookControlsComponent].play(),this.raycastIntersections(t,i,e)},raycastIntersections(e,t,i){if(!this.camera||this.isFrozen||this.isAnimatingBackground)return;this.raycaster.setFromCamera(t,this.camera);let s=this.raycaster.intersectObjects(this.el.object3D.children,!0);this.prevIntersectionEls=this.prevIntersectionEls||[];let n=[];if(s.length&&this.data.debugRaycaster){let e=s[0].point;s[0].object===this.helper&&s.length>1&&(e=s[1].point),this.helper.position.copy(e),this.helper.position.x-=.03}let r=!1;for(let t=0;t<s.length;t++){let o=s[t];if(o.object.el&&o.object.el.classList.contains(this.data.intersectableClass)){let t={intersection:o,evt:e,preventDefault:()=>{r=!0}};-1!==this.prevIntersectionEls.indexOf(o.object.el)||r||o.object.el.emit("mouseenter",t),r&&"ui-mousewheel"!==i||o.object.el.emit(i,t),o.object.el.intersection=o,n.push(o.object.el)}}for(let e=0;e<this.prevIntersectionEls.length;e++){let t=this.prevIntersectionEls[e];-1===n.indexOf(t)&&t.emit("mouseleave",{intersection:t.intersection})}this.prevIntersectionEls=n},tick(e){if(this.isFrozen||this.stoppedRendering||!this.isReady)return;if(e-this.lastRenderTime<1e3/this.data.fps&&this.isRendering)return;this.el.object3D.traverse(e=>{e.updateMatrixWorld()});let t=this.el.sceneEl.renderer,i=t.vr.enabled;t.vr.enabled=!1,t.render(this.el.object3D,this.camera,this.renderTarget),t.vr.enabled=i,this.lastRenderTime=e,this.isRendering||(this.stoppedRendering=!0)}})},60:function(e,t,i){"use strict";i.r(t);i(23),i(11)}});